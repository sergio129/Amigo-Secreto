(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{7203:function(e,s,a){Promise.resolve().then(a.bind(a,9725))},9725:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return i}});var t=a(7437),n=a(2265),l=a(605),r=a(9376);function i(){var e;let{data:s,status:a}=(0,l.useSession)(),i=(0,r.useRouter)(),[o,m]=(0,n.useState)([]),[h,u]=(0,n.useState)([]),[x,v]=(0,n.useState)(!0),[j,N]=(0,n.useState)(!1),[b,p]=(0,n.useState)(!1),[g,f]=(0,n.useState)(null),[y,C]=(0,n.useState)("events");(0,n.useEffect)(()=>{if("loading"!==a){if(!s){i.push("/admin/login");return}E(),"admin"===s.user.role&&D()}},[s,a,i]);let E=async()=>{try{let e=await fetch("/api/admin/events");if(e.ok){let s=await e.json();console.log("Loaded events:",s),m(s)}else console.error("Failed to load events:",e.status)}catch(e){console.error("Error loading events:",e)}finally{v(!1)}},D=async()=>{try{let e=await fetch("/api/admin/users");if(e.ok){let s=await e.json(),a=await Promise.all(s.map(async e=>{try{let s=await fetch("/api/admin/users/".concat(e._id,"/events"));if(s.ok){let a=await s.json();return{...e,eventsCreated:a.length}}return{...e,eventsCreated:0}}catch(s){return console.error("Error loading events for user ".concat(e.email,":"),s),{...e,eventsCreated:0}}}));u(a)}else console.error("Failed to load users:",e.status)}catch(e){console.error("Error loading users:",e)}},k=async(e,s)=>{try{let a=await fetch("/api/admin/users",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,maxEvents:s})});if(a.ok)D();else{let e=await a.json();alert("Error al actualizar el l\xedmite de eventos: ".concat(e.error))}}catch(e){console.error("Error updating user limit:",e),alert("Error al actualizar el l\xedmite de eventos")}},w=async(e,s)=>{try{let a=await fetch("/api/admin/users",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,role:s})});if(a.ok)D();else{let e=await a.json();alert("Error al actualizar el rol: ".concat(e.error))}}catch(e){console.error("Error updating user role:",e),alert("Error al actualizar el rol")}},S=e=>{f(e),p(!0)},A=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar este evento? Se eliminar\xe1n tambi\xe9n todos los participantes asociados."))try{(await fetch("/api/admin/events/".concat(e),{method:"DELETE"})).ok?E():alert("Error al eliminar el evento")}catch(e){console.error("Error deleting event:",e),alert("Error al eliminar el evento")}};return"loading"===a||x?(0,t.jsx)("div",{className:"container py-5 text-center",children:(0,t.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,t.jsx)("span",{className:"visually-hidden",children:"Cargando..."})})}):s?(0,t.jsxs)("div",{className:"container py-4",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{children:"\uD83C\uDF81 Panel de Administraci\xf3n"}),(0,t.jsxs)("p",{className:"text-muted",children:["Bienvenido, ",null===(e=s.user)||void 0===e?void 0:e.email]})]}),(0,t.jsx)("div",{children:(0,t.jsx)("button",{className:"btn btn-outline-danger",onClick:()=>{(0,l.signOut)({callbackUrl:"/admin/login"})},children:"Cerrar sesi\xf3n"})})]}),"admin"===s.user.role&&(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)("ul",{className:"nav nav-tabs",children:[(0,t.jsx)("li",{className:"nav-item",children:(0,t.jsx)("button",{className:"nav-link ".concat("events"===y?"active":""),onClick:()=>C("events"),children:"\uD83D\uDCC5 Gesti\xf3n de Eventos"})}),(0,t.jsx)("li",{className:"nav-item",children:(0,t.jsx)("button",{className:"nav-link ".concat("users"===y?"active":""),onClick:()=>C("users"),children:"\uD83D\uDC65 Gesti\xf3n de Usuarios"})})]})}),"events"===y||"admin"!==s.user.role?(0,t.jsxs)("div",{className:"row mb-4",children:[(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsx)("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("div",{className:"stats-icon",children:"\uD83C\uDF84"}),(0,t.jsx)("h3",{children:o.length}),(0,t.jsx)("p",{className:"text-muted",children:"Eventos Totales"})]})})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsx)("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("div",{className:"stats-icon",children:"✅"}),(0,t.jsx)("h3",{children:o.filter(e=>e.isActive).length}),(0,t.jsx)("p",{className:"text-muted",children:"Eventos Activos"})]})})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsx)("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("div",{className:"stats-icon",children:"\uD83D\uDC65"}),(0,t.jsx)("h3",{children:o.reduce((e,s)=>e+(s.participantCount||0),0)}),(0,t.jsx)("p",{className:"text-muted",children:"Participantes Totales"})]})})})]}):(0,t.jsxs)("div",{className:"row mb-4",children:[(0,t.jsx)("div",{className:"col-md-3",children:(0,t.jsx)("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("div",{className:"stats-icon",children:"\uD83D\uDC65"}),(0,t.jsx)("h3",{children:h.length}),(0,t.jsx)("p",{className:"text-muted",children:"Usuarios Registrados"})]})})}),(0,t.jsx)("div",{className:"col-md-3",children:(0,t.jsx)("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("div",{className:"stats-icon",children:"\uD83D\uDC51"}),(0,t.jsx)("h3",{children:h.filter(e=>"admin"===e.role).length}),(0,t.jsx)("p",{className:"text-muted",children:"Administradores"})]})})}),(0,t.jsx)("div",{className:"col-md-3",children:(0,t.jsx)("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("div",{className:"stats-icon",children:"\uD83C\uDF81"}),(0,t.jsx)("h3",{children:h.filter(e=>"guest"===e.role).reduce((e,s)=>e+s.maxEvents,0)}),(0,t.jsx)("p",{className:"text-muted",children:"L\xedmite Total de Eventos"})]})})}),(0,t.jsx)("div",{className:"col-md-3",children:(0,t.jsx)("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("div",{className:"stats-icon",children:"\uD83D\uDCC5"}),(0,t.jsx)("h3",{children:h.reduce((e,s)=>e+(s.eventsCreated||0),0)}),(0,t.jsx)("p",{className:"text-muted",children:"Eventos Creados"})]})})})]}),"events"===y||"admin"!==s.user.role?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,t.jsx)("h2",{children:"Eventos"}),(0,t.jsx)("button",{className:"btn btn-gradient",onClick:()=>N(!0),children:"➕ Crear Evento"})]}),0===o.length?(0,t.jsx)("div",{className:"card",children:(0,t.jsxs)("div",{className:"card-body text-center py-5",children:[(0,t.jsx)("div",{className:"mb-3",children:"\uD83C\uDF81"}),(0,t.jsx)("h4",{children:"No hay eventos creados"}),(0,t.jsx)("p",{className:"text-muted",children:"Crea tu primer evento de Amigo Secreto"}),(0,t.jsx)("button",{className:"btn btn-gradient",onClick:()=>N(!0),children:"Crear Primer Evento"})]})}):(0,t.jsx)("div",{className:"row",children:o.map(e=>(0,t.jsx)("div",{className:"col-md-6 col-lg-4 mb-3",children:(0,t.jsxs)("div",{className:"card event-card h-100",children:[(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[(0,t.jsx)("h5",{className:"card-title",children:e.name}),(0,t.jsx)("span",{className:"badge ".concat(e.isActive?"bg-success":"bg-secondary"),children:e.isActive?"Activo":"Inactivo"})]}),(0,t.jsx)("p",{className:"card-text text-muted",children:e.description}),(0,t.jsx)("p",{className:"card-text",children:(0,t.jsxs)("small",{className:"text-muted",children:["\uD83D\uDCC5 ",new Date(e.date).toLocaleDateString("es-ES")]})}),(0,t.jsx)("p",{className:"card-text",children:(0,t.jsxs)("small",{className:"text-muted",children:["\uD83D\uDC65 ",e.participantCount||0," participantes"]})})]}),(0,t.jsxs)("div",{className:"card-footer bg-transparent",children:[(0,t.jsx)("button",{className:"btn btn-outline-warning btn-sm me-2",onClick:()=>S(e),children:"✏️ Editar"}),(0,t.jsx)("button",{className:"btn btn-outline-primary btn-sm me-2",onClick:()=>i.push("/admin/events/".concat(e._id)),children:"Gestionar"}),(0,t.jsx)("button",{className:"btn btn-outline-success btn-sm me-2",onClick:()=>window.open("/event/".concat(e._id),"_blank"),children:"Ver P\xfablico"}),(0,t.jsx)("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>A(e._id),children:"Eliminar"})]})]})},e._id))})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:(0,t.jsx)("h2",{children:"Gesti\xf3n de Usuarios"})}),0===h.length?(0,t.jsx)("div",{className:"card",children:(0,t.jsxs)("div",{className:"card-body text-center py-5",children:[(0,t.jsx)("div",{className:"mb-3",children:"\uD83D\uDC65"}),(0,t.jsx)("h4",{children:"No hay usuarios registrados"}),(0,t.jsx)("p",{className:"text-muted",children:"Los usuarios invitados aparecer\xe1n aqu\xed cuando se registren"})]})}):(0,t.jsx)("div",{className:"card",children:(0,t.jsx)("div",{className:"card-body",children:(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-hover",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Nombre"}),(0,t.jsx)("th",{children:"Email"}),(0,t.jsx)("th",{children:"Rol"}),(0,t.jsx)("th",{children:"L\xedmite de Eventos"}),(0,t.jsx)("th",{children:"Eventos Creados"}),(0,t.jsx)("th",{children:"Fecha de Registro"}),(0,t.jsx)("th",{children:"Acciones"})]})}),(0,t.jsx)("tbody",{children:h.map(e=>{var a,n;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.name}),(0,t.jsx)("td",{children:e.email}),(0,t.jsx)("td",{children:(0,t.jsxs)("select",{className:"form-select form-select-sm",value:e.role,onChange:s=>w(e._id,s.target.value),disabled:e.email===(null===(a=s.user)||void 0===a?void 0:a.email),children:[(0,t.jsx)("option",{value:"guest",children:"Invitado"}),(0,t.jsx)("option",{value:"admin",children:"Administrador"})]})}),(0,t.jsx)("td",{children:(0,t.jsx)("input",{type:"number",className:"form-control form-control-sm",style:{width:"80px"},min:"1",value:e.maxEvents,onChange:s=>{let a=parseInt(s.target.value);a>=1&&k(e._id,a)},disabled:"admin"===e.role})}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"badge bg-secondary",children:e.eventsCreated||0})}),(0,t.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString("es-ES")}),(0,t.jsx)("td",{children:(0,t.jsx)("small",{className:"text-muted",children:e.email===(null===(n=s.user)||void 0===n?void 0:n.email)?"Tu cuenta":"admin"===e.role?"Admin":"Editable"})})]},e._id)})})]})})})})]}),j&&(0,t.jsx)(c,{onClose:()=>N(!1),onSuccess:()=>{N(!1),E()}}),b&&g&&(0,t.jsx)(d,{event:g,onClose:()=>{p(!1),f(null)},onSuccess:()=>{p(!1),f(null),E()}})]}):null}function c(e){let{onClose:s,onSuccess:a}=e,[l,r]=(0,n.useState)({name:"",description:"",date:""}),[i,c]=(0,n.useState)(!1),[d,o]=(0,n.useState)(""),m=async e=>{e.preventDefault(),c(!0),o("");try{let e=await fetch("/api/admin/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(e.ok)a();else{let s=await e.json();o(s.error||"Error al crear el evento")}}catch(e){o("Error de conexi\xf3n")}finally{c(!1)}};return(0,t.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,t.jsx)("div",{className:"modal-dialog",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h5",{className:"modal-title",children:"Crear Nuevo Evento"}),(0,t.jsx)("button",{type:"button",className:"btn-close",onClick:s})]}),(0,t.jsxs)("form",{onSubmit:m,children:[(0,t.jsxs)("div",{className:"modal-body",children:[d&&(0,t.jsx)("div",{className:"alert alert-danger",children:d}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"name",className:"form-label",children:"Nombre del Evento"}),(0,t.jsx)("input",{type:"text",className:"form-control",id:"name",value:l.name,onChange:e=>r({...l,name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"description",className:"form-label",children:"Descripci\xf3n"}),(0,t.jsx)("textarea",{className:"form-control",id:"description",rows:3,value:l.description,onChange:e=>r({...l,description:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"date",className:"form-label",children:"Fecha del Evento"}),(0,t.jsx)("input",{type:"date",className:"form-control",id:"date",value:l.date,onChange:e=>r({...l,date:e.target.value}),required:!0})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:s,children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"btn btn-gradient",disabled:i,children:i?"Creando...":"Crear Evento"})]})]})]})})})}function d(e){let{event:s,onClose:a,onSuccess:l}=e,[r,i]=(0,n.useState)({name:s.name,description:s.description,date:s.date.split("T")[0],isActive:s.isActive}),[c,d]=(0,n.useState)(!1),[o,m]=(0,n.useState)(""),h=async e=>{e.preventDefault(),d(!0),m("");try{let e=await fetch("/api/admin/events/".concat(s._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(e.ok)l();else{let s=await e.json();m(s.error||"Error al actualizar el evento")}}catch(e){console.error("Error updating event:",e),m("Error al actualizar el evento")}finally{d(!1)}};return(0,t.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,t.jsx)("div",{className:"modal-dialog modal-lg",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h5",{className:"modal-title",children:"✏️ Editar Evento"}),(0,t.jsx)("button",{type:"button",className:"btn-close",onClick:a})]}),(0,t.jsxs)("form",{onSubmit:h,children:[(0,t.jsxs)("div",{className:"modal-body",children:[o&&(0,t.jsx)("div",{className:"alert alert-danger",children:o}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"edit-name",className:"form-label",children:"Nombre del Evento"}),(0,t.jsx)("input",{type:"text",className:"form-control",id:"edit-name",value:r.name,onChange:e=>i({...r,name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"edit-description",className:"form-label",children:"Descripci\xf3n"}),(0,t.jsx)("textarea",{className:"form-control",id:"edit-description",rows:3,value:r.description,onChange:e=>i({...r,description:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"edit-date",className:"form-label",children:"Fecha del Evento"}),(0,t.jsx)("input",{type:"date",className:"form-control",id:"edit-date",value:r.date,onChange:e=>i({...r,date:e.target.value}),required:!0})]}),(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsxs)("div",{className:"form-check",children:[(0,t.jsx)("input",{className:"form-check-input",type:"checkbox",id:"edit-isActive",checked:r.isActive,onChange:e=>i({...r,isActive:e.target.checked})}),(0,t.jsx)("label",{className:"form-check-label",htmlFor:"edit-isActive",children:"Evento activo (visible para participantes)"})]})})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:a,children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"btn btn-gradient",disabled:c,children:c?"Actualizando...":"Actualizar Evento"})]})]})]})})})}},9376:function(e,s,a){"use strict";var t=a(5475);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}})}},function(e){e.O(0,[605,971,117,560],function(){return e(e.s=7203)}),_N_E=e.O()}]);