(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{7203:function(e,s,a){Promise.resolve().then(a.bind(a,9725))},9725:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return c}});var t=a(7437),n=a(2265),l=a(605),i=a(9376);function c(){var e;let{data:s,status:a}=(0,l.useSession)(),c=(0,i.useRouter)(),[d,o]=(0,n.useState)([]),[m,u]=(0,n.useState)(!0),[h,x]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if("loading"!==a){if(!s){c.push("/admin/login");return}v()}},[s,a,c]);let v=async()=>{try{let e=await fetch("/api/admin/events");if(e.ok){let s=await e.json();console.log("Loaded events:",s),o(s)}else console.error("Failed to load events:",e.status)}catch(e){console.error("Error loading events:",e)}finally{u(!1)}},j=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar este evento? Se eliminar\xe1n tambi\xe9n todos los participantes asociados."))try{(await fetch("/api/admin/events/".concat(e),{method:"DELETE"})).ok?v():alert("Error al eliminar el evento")}catch(e){console.error("Error deleting event:",e),alert("Error al eliminar el evento")}};return"loading"===a||m?(0,t.jsx)("div",{className:"container py-5 text-center",children:(0,t.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,t.jsx)("span",{className:"visually-hidden",children:"Cargando..."})})}):s?(0,t.jsxs)("div",{className:"container py-4",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{children:"\uD83C\uDF81 Panel de Administraci\xf3n"}),(0,t.jsxs)("p",{className:"text-muted",children:["Bienvenido, ",null===(e=s.user)||void 0===e?void 0:e.email]})]}),(0,t.jsx)("div",{children:(0,t.jsx)("button",{className:"btn btn-outline-danger",onClick:()=>{(0,l.signOut)({callbackUrl:"/admin/login"})},children:"Cerrar sesi\xf3n"})})]}),(0,t.jsxs)("div",{className:"row mb-4",children:[(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsx)("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("div",{className:"stats-icon",children:"\uD83C\uDF84"}),(0,t.jsx)("h3",{children:d.length}),(0,t.jsx)("p",{className:"text-muted",children:"Eventos Totales"})]})})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsx)("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("div",{className:"stats-icon",children:"✅"}),(0,t.jsx)("h3",{children:d.filter(e=>e.isActive).length}),(0,t.jsx)("p",{className:"text-muted",children:"Eventos Activos"})]})})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsx)("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("div",{className:"stats-icon",children:"\uD83D\uDC65"}),(0,t.jsx)("h3",{children:d.reduce((e,s)=>e+(s.participantCount||0),0)}),(0,t.jsx)("p",{className:"text-muted",children:"Participantes Totales"})]})})})]}),(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,t.jsx)("h2",{children:"Eventos"}),(0,t.jsx)("button",{className:"btn btn-gradient",onClick:()=>x(!0),children:"➕ Crear Evento"})]}),0===d.length?(0,t.jsx)("div",{className:"card",children:(0,t.jsxs)("div",{className:"card-body text-center py-5",children:[(0,t.jsx)("div",{className:"mb-3",children:"\uD83C\uDF81"}),(0,t.jsx)("h4",{children:"No hay eventos creados"}),(0,t.jsx)("p",{className:"text-muted",children:"Crea tu primer evento de Amigo Secreto"}),(0,t.jsx)("button",{className:"btn btn-gradient",onClick:()=>x(!0),children:"Crear Primer Evento"})]})}):(0,t.jsx)("div",{className:"row",children:d.map(e=>(0,t.jsx)("div",{className:"col-md-6 col-lg-4 mb-3",children:(0,t.jsxs)("div",{className:"card event-card h-100",children:[(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[(0,t.jsx)("h5",{className:"card-title",children:e.name}),(0,t.jsx)("span",{className:"badge ".concat(e.isActive?"bg-success":"bg-secondary"),children:e.isActive?"Activo":"Inactivo"})]}),(0,t.jsx)("p",{className:"card-text text-muted",children:e.description}),(0,t.jsx)("p",{className:"card-text",children:(0,t.jsxs)("small",{className:"text-muted",children:["\uD83D\uDCC5 ",new Date(e.date).toLocaleDateString("es-ES")]})}),(0,t.jsx)("p",{className:"card-text",children:(0,t.jsxs)("small",{className:"text-muted",children:["\uD83D\uDC65 ",e.participantCount||0," participantes"]})})]}),(0,t.jsxs)("div",{className:"card-footer bg-transparent",children:[(0,t.jsx)("button",{className:"btn btn-outline-primary btn-sm me-2",onClick:()=>c.push("/admin/events/".concat(e._id)),children:"Gestionar"}),(0,t.jsx)("button",{className:"btn btn-outline-success btn-sm me-2",onClick:()=>window.open("/event/".concat(e._id),"_blank"),children:"Ver P\xfablico"}),(0,t.jsx)("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>j(e._id),children:"Eliminar"})]})]})},e._id))}),h&&(0,t.jsx)(r,{onClose:()=>x(!1),onSuccess:()=>{x(!1),v()}})]}):null}function r(e){let{onClose:s,onSuccess:a}=e,[l,i]=(0,n.useState)({name:"",description:"",date:""}),[c,r]=(0,n.useState)(!1),[d,o]=(0,n.useState)(""),m=async e=>{e.preventDefault(),r(!0),o("");try{let e=await fetch("/api/admin/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(e.ok)a();else{let s=await e.json();o(s.error||"Error al crear el evento")}}catch(e){o("Error de conexi\xf3n")}finally{r(!1)}};return(0,t.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,t.jsx)("div",{className:"modal-dialog",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h5",{className:"modal-title",children:"Crear Nuevo Evento"}),(0,t.jsx)("button",{type:"button",className:"btn-close",onClick:s})]}),(0,t.jsxs)("form",{onSubmit:m,children:[(0,t.jsxs)("div",{className:"modal-body",children:[d&&(0,t.jsx)("div",{className:"alert alert-danger",children:d}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"name",className:"form-label",children:"Nombre del Evento"}),(0,t.jsx)("input",{type:"text",className:"form-control",id:"name",value:l.name,onChange:e=>i({...l,name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"description",className:"form-label",children:"Descripci\xf3n"}),(0,t.jsx)("textarea",{className:"form-control",id:"description",rows:3,value:l.description,onChange:e=>i({...l,description:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"date",className:"form-label",children:"Fecha del Evento"}),(0,t.jsx)("input",{type:"date",className:"form-control",id:"date",value:l.date,onChange:e=>i({...l,date:e.target.value}),required:!0})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:s,children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"btn btn-gradient",disabled:c,children:c?"Creando...":"Crear Evento"})]})]})]})})})}},9376:function(e,s,a){"use strict";var t=a(5475);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}})}},function(e){e.O(0,[605,971,117,560],function(){return e(e.s=7203)}),_N_E=e.O()}]);