(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[699],{7281:function(e,a,s){Promise.resolve().then(s.bind(s,2514))},2514:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return r}});var i=s(7437),n=s(2265),t=s(605),c=s(9376),l=s(5571);function r(){var e;let{data:a,status:s}=(0,t.useSession)(),r=(0,c.useRouter)(),o=(0,c.useParams)().id,m=(null==a?void 0:null===(e=a.user)||void 0===e?void 0:e.role)==="admin",[h,u]=(0,n.useState)(null),[x,j]=(0,n.useState)([]),[b,p]=(0,n.useState)(!0),[v,N]=(0,n.useState)(!1),[g,y]=(0,n.useState)(!1),[f,C]=(0,n.useState)(!1),[D,E]=(0,n.useState)(!1),[k,A]=(0,n.useState)(null),[S,w]=(0,n.useState)({name:"",email:""});(0,n.useEffect)(()=>{if("loading"!==s){if(!a){r.push("/admin/login");return}if(o){var e;P(),(null===(e=a.user)||void 0===e?void 0:e.role)==="admin"&&_()}}},[a,s,r,o]);let P=async()=>{try{let e=await fetch("/api/admin/events/".concat(o));if(e.ok){let a=await e.json();u(a)}}catch(e){console.error("Error loading event:",e)}finally{p(!1)}},_=async()=>{try{let e=await fetch("/api/admin/events/".concat(o,"/assignments"));if(e.ok){let a=await e.json();j(a)}}catch(e){console.error("Error loading assignments:",e)}},T=async e=>{e.preventDefault();try{(await fetch("/api/admin/events/".concat(o,"/participants"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)})).ok&&(N(!1),w({name:"",email:""}),P())}catch(e){console.error("Error adding participant:",e)}},F=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar este participante?"))try{(await fetch("/api/admin/events/".concat(o,"/participants/").concat(e),{method:"DELETE"})).ok&&P()}catch(e){console.error("Error deleting participant:",e)}},q=e=>{A(e),y(!0)},R=async()=>{if(h)try{(await fetch("/api/admin/events/".concat(o),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!h.isActive})})).ok&&P()}catch(e){console.error("Error updating event:",e)}};if("loading"===s||b)return(0,i.jsx)("div",{className:"container py-5 text-center",children:(0,i.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,i.jsx)("span",{className:"visually-hidden",children:"Cargando..."})})});if(!a||!h)return null;return(0,i.jsxs)("div",{className:"container py-4",children:[(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{children:"\uD83C\uDF81 Gestionar Evento"}),(0,i.jsx)("h3",{children:h.name}),(0,i.jsx)("p",{className:"text-muted",children:h.description})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("button",{className:"btn btn-outline-secondary me-2",onClick:()=>r.push("/admin"),children:"← Volver"}),(0,i.jsx)("button",{className:"btn ".concat(h.isActive?"btn-warning":"btn-success"),onClick:R,children:h.isActive?"Desactivar":"Activar"})]})]}),m&&(0,i.jsxs)("div",{className:"d-flex justify-content-end mb-4",children:[(0,i.jsx)("button",{className:"btn btn-danger me-2",onClick:function(){E(!0)},children:"Limpiar Asignaciones"}),(0,i.jsx)("button",{className:"btn btn-primary",onClick:()=>C(!0),children:"Reactivar Participante"})]}),!m&&(0,i.jsxs)("div",{className:"alert alert-info mb-4",children:[(0,i.jsx)("h5",{children:"\uD83D\uDD12 Acceso Limitado"}),(0,i.jsx)("p",{children:"Las opciones de administraci\xf3n (limpiar asignaciones, reactivar participantes) solo est\xe1n disponibles para administradores."}),(0,i.jsxs)("div",{className:"mt-3",children:[(0,i.jsx)("p",{className:"mb-2",children:(0,i.jsx)("strong",{children:"\uD83D\uDCE7 Contacto:"})}),(0,i.jsxs)("p",{className:"mb-1",children:["✉️ ",(0,i.jsx)("strong",{children:"Email:"})," ",(0,i.jsx)("a",{href:"mailto:sanayaromero62@gmail.com",className:"text-decoration-none",children:"sanayaromero62@gmail.com"})]}),(0,i.jsxs)("p",{className:"mb-0",children:["\uD83D\uDCF1 ",(0,i.jsx)("strong",{children:"Tel\xe9fono:"})," ",(0,i.jsx)("a",{href:"tel:3103904286",className:"text-decoration-none",children:"310 390 4286"})]})]})]}),f&&(0,i.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,i.jsx)("div",{className:"modal-dialog",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h5",{className:"modal-title",children:"Reactivar Participante"}),(0,i.jsx)("button",{type:"button",className:"btn-close",onClick:()=>C(!1)})]}),(0,i.jsx)("div",{className:"modal-body",children:(0,i.jsx)("div",{className:"table-responsive",children:(0,i.jsxs)("table",{className:"table table-hover",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Nombre"}),(0,i.jsx)("th",{children:"Email"}),(0,i.jsx)("th",{children:"Acciones"})]})}),(0,i.jsx)("tbody",{children:h.participants.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.name}),(0,i.jsx)("td",{children:e.email||"-"}),(0,i.jsx)("td",{children:e.isRevealed&&(0,i.jsx)("button",{className:"btn btn-outline-success btn-sm",onClick:()=>O(e._id),children:"Reactivar"})})]},e._id))})]})})}),(0,i.jsx)("div",{className:"modal-footer",children:(0,i.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>C(!1),children:"Cerrar"})})]})})}),D&&(0,i.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,i.jsx)("div",{className:"modal-dialog",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h5",{className:"modal-title",children:"⚠️ Confirmar Acci\xf3n"}),(0,i.jsx)("button",{type:"button",className:"btn-close",onClick:()=>E(!1)})]}),(0,i.jsxs)("div",{className:"modal-body",children:[(0,i.jsx)("p",{children:"\xbfEst\xe1s seguro de que quieres limpiar todas las asignaciones?"}),(0,i.jsx)("p",{className:"text-muted",children:"Esta acci\xf3n no se puede deshacer."})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>E(!1),children:"Cancelar"}),(0,i.jsx)("button",{type:"button",className:"btn btn-danger",onClick:L,children:"S\xed, limpiar asignaciones"})]})]})})}),(0,i.jsxs)("div",{className:"row mb-4",children:[(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsx)("h5",{className:"card-title",children:"\uD83D\uDCCA Estad\xedsticas"}),(0,i.jsxs)("p",{className:"mb-1",children:["\uD83D\uDC65 Participantes: ",h.participants.length]}),(0,i.jsxs)("p",{className:"mb-1",children:["\uD83D\uDCC5 Fecha: ",new Date(h.date).toLocaleDateString("es-ES")]}),(0,i.jsxs)("p",{className:"mb-0",children:["\uD83D\uDCCA Estado: ",h.isActive?"Activo":"Inactivo"]})]})})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsx)("h5",{className:"card-title",children:"\uD83D\uDD17 Enlaces"}),(0,i.jsx)("p",{children:(0,i.jsx)("a",{href:"/event/".concat(h._id),target:"_blank",rel:"noopener noreferrer",className:"btn btn-outline-primary btn-sm me-2",children:"Ver P\xe1gina P\xfablica"})})]})})})]}),m&&(0,i.jsx)("div",{className:"card mb-4",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsx)("h5",{className:"card-title",children:"\uD83C\uDF81 Asignaciones del Amigo Secreto"}),0===x.length?(0,i.jsx)("p",{className:"text-muted",children:"No hay asignaciones disponibles."}):(0,i.jsx)("div",{className:"table-responsive",children:(0,i.jsxs)("table",{className:"table table-hover",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Regala"}),(0,i.jsx)("th",{children:"Recibe"})]})}),(0,i.jsx)("tbody",{children:x.map(e=>{let a=null==h?void 0:h.participants.find(a=>a._id===e.giverId),s=null==h?void 0:h.participants.find(a=>a._id===e.receiverId);return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(null==a?void 0:a.name)||"Desconocido"}),(0,i.jsx)("td",{children:(null==s?void 0:s.name)||"Desconocido"})]},e._id)})})]})})]})}),(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,i.jsx)("h2",{children:"Participantes"}),(0,i.jsx)("button",{className:"btn btn-gradient",onClick:()=>N(!0),children:"➕ Agregar Participante"})]}),0===h.participants.length?(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body text-center py-5",children:[(0,i.jsx)("div",{className:"mb-3",children:"\uD83D\uDC65"}),(0,i.jsx)("h4",{children:"No hay participantes"}),(0,i.jsx)("p",{className:"text-muted",children:"Agrega participantes para que puedan seleccionar su amigo secreto"}),(0,i.jsx)("button",{className:"btn btn-gradient",onClick:()=>N(!0),children:"Agregar Primer Participante"})]})}):(0,i.jsx)("div",{className:"card",children:(0,i.jsx)("div",{className:"card-body",children:(0,i.jsx)("div",{className:"table-responsive",children:(0,i.jsxs)("table",{className:"table table-hover",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Nombre"}),(0,i.jsx)("th",{children:"Email"}),(0,i.jsx)("th",{children:"Acciones"})]})}),(0,i.jsx)("tbody",{children:h.participants.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.name}),(0,i.jsx)("td",{children:e.email||"-"}),(0,i.jsxs)("td",{children:[(0,i.jsx)("button",{className:"btn btn-outline-warning btn-sm me-2",onClick:()=>q(e),children:"✏️ Editar"}),(0,i.jsx)("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>F(e._id),children:"Eliminar"})]})]},e._id))})]})})})}),v&&(0,i.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,i.jsx)("div",{className:"modal-dialog",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h5",{className:"modal-title",children:"Agregar Participante"}),(0,i.jsx)("button",{type:"button",className:"btn-close",onClick:()=>N(!1)})]}),(0,i.jsxs)("form",{onSubmit:T,children:[(0,i.jsxs)("div",{className:"modal-body",children:[(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{htmlFor:"name",className:"form-label",children:"Nombre *"}),(0,i.jsx)("input",{type:"text",className:"form-control",id:"name",value:S.name,onChange:e=>w({...S,name:e.target.value}),required:!0})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{htmlFor:"email",className:"form-label",children:"Email (opcional)"}),(0,i.jsx)("input",{type:"email",className:"form-control",id:"email",value:S.email,onChange:e=>w({...S,email:e.target.value})})]})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>N(!1),children:"Cancelar"}),(0,i.jsx)("button",{type:"submit",className:"btn btn-gradient",children:"Agregar Participante"})]})]})]})})}),g&&k&&(0,i.jsx)(d,{participant:k,eventId:o,onClose:()=>{y(!1),A(null)},onSuccess:()=>{y(!1),A(null),P()}}),(0,i.jsx)(l.Ix,{})]});async function L(){E(!1);try{(await fetch("/api/admin/events/".concat(o,"/assignments"),{method:"DELETE"})).ok?(l.Am.success("Asignaciones limpiadas correctamente"),P(),_()):l.Am.error("Error al limpiar asignaciones")}catch(e){console.error("Error clearing assignments:",e),l.Am.error("Error al limpiar asignaciones")}}async function O(e){try{(await fetch("/api/admin/events/".concat(o,"/participants/").concat(e,"/reactivate"),{method:"PATCH"})).ok?(l.Am.success("Participante reactivado correctamente"),P()):l.Am.error("Error al reactivar participante")}catch(e){console.error("Error reactivating participant:",e),l.Am.error("Error al reactivar participante")}}}function d(e){let{participant:a,eventId:s,onClose:t,onSuccess:c}=e,[l,r]=(0,n.useState)({name:a.name,email:a.email||""}),[d,o]=(0,n.useState)(!1),[m,h]=(0,n.useState)(""),u=async e=>{e.preventDefault(),o(!0),h("");try{let e=await fetch("/api/admin/events/".concat(s,"/participants/").concat(a._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(e.ok)c();else{let a=await e.json();h(a.error||"Error al actualizar el participante")}}catch(e){console.error("Error updating participant:",e),h("Error al actualizar el participante")}finally{o(!1)}};return(0,i.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,i.jsx)("div",{className:"modal-dialog",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h5",{className:"modal-title",children:"✏️ Editar Participante"}),(0,i.jsx)("button",{type:"button",className:"btn-close",onClick:t})]}),(0,i.jsxs)("form",{onSubmit:u,children:[(0,i.jsxs)("div",{className:"modal-body",children:[m&&(0,i.jsx)("div",{className:"alert alert-danger",children:m}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{htmlFor:"edit-participant-name",className:"form-label",children:"Nombre"}),(0,i.jsx)("input",{type:"text",className:"form-control",id:"edit-participant-name",value:l.name,onChange:e=>r({...l,name:e.target.value}),required:!0})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{htmlFor:"edit-participant-email",className:"form-label",children:"Email (opcional)"}),(0,i.jsx)("input",{type:"email",className:"form-control",id:"edit-participant-email",value:l.email,onChange:e=>r({...l,email:e.target.value})})]})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:t,children:"Cancelar"}),(0,i.jsx)("button",{type:"submit",className:"btn btn-gradient",disabled:d,children:d?"Actualizando...":"Actualizar Participante"})]})]})]})})})}}},function(e){e.O(0,[605,557,971,117,560],function(){return e(e.s=7281)}),_N_E=e.O()}]);