(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[699],{7281:function(e,a,s){Promise.resolve().then(s.bind(s,2514))},2514:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return c}});var t=s(7437),n=s(2265),i=s(605),l=s(9376);function c(){let{data:e,status:a}=(0,i.useSession)(),s=(0,l.useRouter)(),c=(0,l.useParams)().id,[d,o]=(0,n.useState)(null),[m,h]=(0,n.useState)(!0),[u,p]=(0,n.useState)(!1),[b,x]=(0,n.useState)(!1),[j,N]=(0,n.useState)(null),[v,g]=(0,n.useState)({name:"",email:""});(0,n.useEffect)(()=>{if("loading"!==a){if(!e){s.push("/admin/login");return}c&&f()}},[e,a,s,c]);let f=async()=>{try{let e=await fetch("/api/admin/events/".concat(c));if(e.ok){let a=await e.json();o(a)}}catch(e){console.error("Error loading event:",e)}finally{h(!1)}},y=async e=>{e.preventDefault();try{(await fetch("/api/admin/events/".concat(c,"/participants"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)})).ok&&(p(!1),g({name:"",email:""}),f())}catch(e){console.error("Error adding participant:",e)}},C=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar este participante?"))try{(await fetch("/api/admin/events/".concat(c,"/participants/").concat(e),{method:"DELETE"})).ok&&f()}catch(e){console.error("Error deleting participant:",e)}},D=e=>{N(e),x(!0)},E=async()=>{if(d)try{(await fetch("/api/admin/events/".concat(c),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!d.isActive})})).ok&&f()}catch(e){console.error("Error updating event:",e)}};return"loading"===a||m?(0,t.jsx)("div",{className:"container py-5 text-center",children:(0,t.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,t.jsx)("span",{className:"visually-hidden",children:"Cargando..."})})}):e&&d?(0,t.jsxs)("div",{className:"container py-4",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{children:"\uD83C\uDF81 Gestionar Evento"}),(0,t.jsx)("h3",{children:d.name}),(0,t.jsx)("p",{className:"text-muted",children:d.description})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{className:"btn btn-outline-secondary me-2",onClick:()=>s.push("/admin"),children:"← Volver"}),(0,t.jsx)("button",{className:"btn ".concat(d.isActive?"btn-warning":"btn-success"),onClick:E,children:d.isActive?"Desactivar":"Activar"})]})]}),(0,t.jsxs)("div",{className:"row mb-4",children:[(0,t.jsx)("div",{className:"col-md-6",children:(0,t.jsx)("div",{className:"card",children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("h5",{className:"card-title",children:"\uD83D\uDCCA Estad\xedsticas"}),(0,t.jsxs)("p",{className:"mb-1",children:["\uD83D\uDC65 Participantes: ",d.participants.length]}),(0,t.jsxs)("p",{className:"mb-1",children:["\uD83D\uDCC5 Fecha: ",new Date(d.date).toLocaleDateString("es-ES")]}),(0,t.jsxs)("p",{className:"mb-0",children:["\uD83D\uDCCA Estado: ",d.isActive?"Activo":"Inactivo"]})]})})}),(0,t.jsx)("div",{className:"col-md-6",children:(0,t.jsx)("div",{className:"card",children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("h5",{className:"card-title",children:"\uD83D\uDD17 Enlaces"}),(0,t.jsx)("p",{children:(0,t.jsx)("a",{href:"/event/".concat(d._id),target:"_blank",rel:"noopener noreferrer",className:"btn btn-outline-primary btn-sm me-2",children:"Ver P\xe1gina P\xfablica"})})]})})})]}),(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,t.jsx)("h2",{children:"Participantes"}),(0,t.jsx)("button",{className:"btn btn-gradient",onClick:()=>p(!0),children:"➕ Agregar Participante"})]}),0===d.participants.length?(0,t.jsx)("div",{className:"card",children:(0,t.jsxs)("div",{className:"card-body text-center py-5",children:[(0,t.jsx)("div",{className:"mb-3",children:"\uD83D\uDC65"}),(0,t.jsx)("h4",{children:"No hay participantes"}),(0,t.jsx)("p",{className:"text-muted",children:"Agrega participantes para que puedan seleccionar su amigo secreto"}),(0,t.jsx)("button",{className:"btn btn-gradient",onClick:()=>p(!0),children:"Agregar Primer Participante"})]})}):(0,t.jsx)("div",{className:"card",children:(0,t.jsx)("div",{className:"card-body",children:(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-hover",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Nombre"}),(0,t.jsx)("th",{children:"Email"}),(0,t.jsx)("th",{children:"Acciones"})]})}),(0,t.jsx)("tbody",{children:d.participants.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.name}),(0,t.jsx)("td",{children:e.email||"-"}),(0,t.jsxs)("td",{children:[(0,t.jsx)("button",{className:"btn btn-outline-warning btn-sm me-2",onClick:()=>D(e),children:"✏️ Editar"}),(0,t.jsx)("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>C(e._id),children:"Eliminar"})]})]},e._id))})]})})})}),u&&(0,t.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,t.jsx)("div",{className:"modal-dialog",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h5",{className:"modal-title",children:"Agregar Participante"}),(0,t.jsx)("button",{type:"button",className:"btn-close",onClick:()=>p(!1)})]}),(0,t.jsxs)("form",{onSubmit:y,children:[(0,t.jsxs)("div",{className:"modal-body",children:[(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"name",className:"form-label",children:"Nombre *"}),(0,t.jsx)("input",{type:"text",className:"form-control",id:"name",value:v.name,onChange:e=>g({...v,name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"email",className:"form-label",children:"Email (opcional)"}),(0,t.jsx)("input",{type:"email",className:"form-control",id:"email",value:v.email,onChange:e=>g({...v,email:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>p(!1),children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"btn btn-gradient",children:"Agregar Participante"})]})]})]})})}),b&&j&&(0,t.jsx)(r,{participant:j,eventId:c,onClose:()=>{x(!1),N(null)},onSuccess:()=>{x(!1),N(null),f()}})]}):null}function r(e){let{participant:a,eventId:s,onClose:i,onSuccess:l}=e,[c,r]=(0,n.useState)({name:a.name,email:a.email||""}),[d,o]=(0,n.useState)(!1),[m,h]=(0,n.useState)(""),u=async e=>{e.preventDefault(),o(!0),h("");try{let e=await fetch("/api/admin/events/".concat(s,"/participants/").concat(a._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(e.ok)l();else{let a=await e.json();h(a.error||"Error al actualizar el participante")}}catch(e){console.error("Error updating participant:",e),h("Error al actualizar el participante")}finally{o(!1)}};return(0,t.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,t.jsx)("div",{className:"modal-dialog",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h5",{className:"modal-title",children:"✏️ Editar Participante"}),(0,t.jsx)("button",{type:"button",className:"btn-close",onClick:i})]}),(0,t.jsxs)("form",{onSubmit:u,children:[(0,t.jsxs)("div",{className:"modal-body",children:[m&&(0,t.jsx)("div",{className:"alert alert-danger",children:m}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"edit-participant-name",className:"form-label",children:"Nombre"}),(0,t.jsx)("input",{type:"text",className:"form-control",id:"edit-participant-name",value:c.name,onChange:e=>r({...c,name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"edit-participant-email",className:"form-label",children:"Email (opcional)"}),(0,t.jsx)("input",{type:"email",className:"form-control",id:"edit-participant-email",value:c.email,onChange:e=>r({...c,email:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:i,children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"btn btn-gradient",disabled:d,children:d?"Actualizando...":"Actualizar Participante"})]})]})]})})})}},9376:function(e,a,s){"use strict";var t=s(5475);s.o(t,"useParams")&&s.d(a,{useParams:function(){return t.useParams}}),s.o(t,"useRouter")&&s.d(a,{useRouter:function(){return t.useRouter}})}},function(e){e.O(0,[605,971,117,560],function(){return e(e.s=7281)}),_N_E=e.O()}]);