(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[744],{6981:function(e,s,a){Promise.resolve().then(a.bind(a,4952))},4952:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return c}});var t=a(7437),i=a(2265),n=a(9376);function c(){let e=(0,n.useParams)().id,[s,a]=(0,i.useState)(null),[c,r]=(0,i.useState)(!0),[l,o]=(0,i.useState)(null),[d,m]=(0,i.useState)(!1),[u,h]=(0,i.useState)(""),[p,x]=(0,i.useState)({}),[j,v]=(0,i.useState)(new Set),[b,N]=(0,i.useState)(null);(0,i.useEffect)(()=>{e&&y()},[e]),(0,i.useEffect)(()=>(d?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[d]);let g=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";N({message:e,type:s,show:!0}),setTimeout(()=>{N(null)},5e3)},y=async()=>{try{let s=await fetch("/api/public/events/".concat(e));if(s.ok){let e=await s.json();a(e),await f(e._id)}else console.error("Event not found")}catch(e){console.error("Error loading event:",e)}finally{r(!1)}},f=async e=>{try{let s=await fetch("/api/public/events/".concat(e));if(s.ok){let e=(await s.json()).participants.filter(e=>e.isRevealed).map(e=>e.name);v(new Set(e))}}catch(e){console.error("Error loading revelation status:",e)}},D=async e=>{if(!j.has(e)&&!d){o(e);try{if(s){let a=await fetch("/api/public/events/".concat(s._id,"/assignments"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({participantName:e})});if(a.ok){let s=await a.json();h(s.assignment.receiver),m(!0);let t=new Set(j);t.add(e),v(t)}else{let e=await a.json();console.error("Error generating assignment:",e),"No hay participantes disponibles para asignar"===e.error?g("\uD83C\uDF84 \xa1Felicitaciones! Ya todos los participantes han descubierto sus amigos secretos. El intercambio puede comenzar. \uD83C\uDF81","success"):"Participante ya revelado"===e.error?g("Ya has descubierto tu amigo secreto anteriormente.","info"):g("Error al generar la asignaci\xf3n. Int\xe9ntalo de nuevo.","error")}}}catch(e){console.error("Error generating assignment:",e),alert("Error al generar la asignaci\xf3n. Int\xe9ntalo de nuevo.")}}};return c?(0,t.jsx)("div",{className:"container py-5",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,t.jsx)("span",{className:"visually-hidden",children:"Cargando..."})}),(0,t.jsx)("p",{className:"mt-3",children:"Cargando evento..."})]})}):s?(0,t.jsxs)("div",{className:"container py-5",children:[(0,t.jsxs)("div",{className:"text-center mb-5",children:[(0,t.jsxs)("h1",{className:"display-title mb-3",children:["\uD83C\uDF81 ",s.name]}),(0,t.jsx)("p",{className:"text-muted mb-4",children:s.description}),(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)("small",{className:"text-muted",children:["\uD83D\uDC65 ",s.participants.length," participantes"]})})]}),(0,t.jsxs)("div",{className:"main-card mx-auto p-4",children:[(0,t.jsxs)("div",{className:"text-center mb-4",children:[(0,t.jsx)("h3",{className:"mb-3",children:"\uD83C\uDF81 Selecciona tu nombre \uD83C\uDF81"}),(0,t.jsx)("p",{className:"text-muted",children:"Haz clic en tu nombre para descubrir a qui\xe9n debes regalar"}),(0,t.jsx)("div",{className:"christmas-decoration"})]}),(0,t.jsxs)("div",{className:"participants-modal-container",children:[(0,t.jsxs)("div",{className:"participants-modal-header",children:[(0,t.jsx)("div",{className:"modal-icon",children:"\uD83D\uDC65"}),(0,t.jsx)("h5",{className:"modal-title",children:"Lista de Participantes"}),(0,t.jsx)("div",{className:"modal-subtitle",children:"Elige tu nombre de la lista"})]}),(0,t.jsx)("div",{className:"participants-modal-body",children:(0,t.jsx)("div",{className:"participants-grid",children:s.participants.map((e,s)=>{let a=j.has(e.name);return(0,t.jsxs)("button",{className:"participant-button ".concat(a?"revealed":"available"),onClick:()=>D(e.name),disabled:a,style:{animationDelay:"".concat(.1*s,"s")},children:[(0,t.jsxs)("div",{className:"participant-content",children:[(0,t.jsx)("div",{className:"participant-name",children:e.name}),(0,t.jsx)("div",{className:"participant-status",children:a?(0,t.jsxs)("div",{className:"status-revealed",children:[(0,t.jsx)("span",{className:"status-icon",children:"✅"}),(0,t.jsx)("span",{className:"status-text",children:"Revelado"})]}):(0,t.jsxs)("div",{className:"status-available",children:[(0,t.jsx)("span",{className:"status-icon",children:"\uD83D\uDC46"}),(0,t.jsx)("span",{className:"status-text",children:"Haz clic"})]})})]}),!a&&(0,t.jsx)("div",{className:"button-glow"})]},e._id)})})})]}),(0,t.jsxs)("div",{className:"text-center mt-4",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsxs)("small",{className:"text-muted",children:[j.size," de ",s.participants.length," participantes han descubierto su amigo secreto"]})}),j.size===s.participants.length?(0,t.jsx)("div",{className:"alert alert-success py-2",children:(0,t.jsx)("small",{children:"\uD83C\uDF84 \xa1Felicitaciones! Todos los participantes han descubierto sus amigos secretos. \xa1El intercambio puede comenzar! \uD83C\uDF81"})}):(0,t.jsx)("div",{className:"progress",style:{height:"6px"},children:(0,t.jsx)("div",{className:"progress-bar bg-success",style:{width:"".concat(j.size/s.participants.length*100,"%")}})})]})]}),d&&(0,t.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.8)",zIndex:1060},children:(0,t.jsx)("div",{className:"modal-dialog modal-dialog-centered",children:(0,t.jsx)("div",{className:"modal-content party-modal",children:(0,t.jsxs)("div",{className:"modal-body text-center p-5",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("span",{style:{fontSize:"3rem"},children:"\uD83C\uDF89"})}),(0,t.jsx)("h4",{className:"mb-3",children:"\xa1Felicitaciones!"}),(0,t.jsxs)("div",{id:"secretAssignedText",children:[l,", ",(0,t.jsx)("br",{}),"tu Amigo Secreto es:",(0,t.jsx)("br",{}),(0,t.jsx)("strong",{style:{fontSize:"1.6rem",color:"#ff6b6b"},children:u})]}),(0,t.jsx)("button",{className:"btn btn-gradient mt-4 px-4 py-2",onClick:()=>{m(!1),o(null),h("")},style:{zIndex:1061},children:"\xa1Entendido!"})]})})})}),b&&b.show&&(0,t.jsxs)("div",{className:"toast show position-fixed",style:{top:"20px",right:"20px",zIndex:1070,minWidth:"300px"},role:"alert","aria-live":"assertive","aria-atomic":"true",children:[(0,t.jsxs)("div",{className:"toast-header bg-".concat("success"===b.type?"success":"error"===b.type?"danger":"info"," text-white"),children:[(0,t.jsxs)("strong",{className:"me-auto",children:["success"===b.type&&"\uD83C\uDF84 \xa1Felicitaciones!","error"===b.type&&"❌ Error","info"===b.type&&"ℹ️ Informaci\xf3n"]}),(0,t.jsx)("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>{N(null)},"aria-label":"Close"})]}),(0,t.jsx)("div",{className:"toast-body",children:b.message})]})]}):(0,t.jsx)("div",{className:"container py-5",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("span",{style:{fontSize:"4rem"},children:"\uD83C\uDF84"})}),(0,t.jsx)("h2",{children:"Evento no encontrado"}),(0,t.jsx)("p",{className:"text-muted",children:"El evento que buscas no existe o ha sido eliminado"})]})})}},9376:function(e,s,a){"use strict";var t=a(5475);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}})}},function(e){e.O(0,[971,117,560],function(){return e(e.s=6981)}),_N_E=e.O()}]);