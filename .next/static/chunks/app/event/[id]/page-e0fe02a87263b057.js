(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[744],{6981:function(e,s,t){Promise.resolve().then(t.bind(t,4952))},4952:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return r}});var a=t(7437),n=t(2265),i=t(9376);function r(){let e=(0,i.useParams)().id,[s,t]=(0,n.useState)(null),[r,c]=(0,n.useState)(!0),[l,o]=(0,n.useState)(null),[d,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(""),[p,x]=(0,n.useState)({}),[b,j]=(0,n.useState)(new Set),[v,g]=(0,n.useState)(null);(0,n.useEffect)(()=>{e&&f()},[e]),(0,n.useEffect)(()=>(d?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[d]);let N=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";g({message:e,type:s,show:!0}),setTimeout(()=>{g(null)},5e3)},f=async()=>{try{let s=await fetch("/api/public/events/".concat(e));if(s.ok){let e=await s.json();t(e),await y(e._id)}else console.error("Event not found")}catch(e){console.error("Error loading event:",e)}finally{c(!1)}},y=async e=>{try{let s=await fetch("/api/public/events/".concat(e));if(s.ok){let e=(await s.json()).participants.filter(e=>e.isRevealed).map(e=>e.name);j(new Set(e))}}catch(e){console.error("Error loading revelation status:",e)}},w=async e=>{if(!b.has(e)&&!d){o(e);try{if(s){let t=await fetch("/api/public/events/".concat(s._id,"/assignments"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({participantName:e})});if(t.ok){let s=await t.json();h(s.assignment.receiver),u(!0);let a=new Set(b);a.add(e),j(a)}else{let e=await t.json();console.error("Error generating assignment:",e),"No hay participantes disponibles para asignar"===e.error?N("\uD83C\uDF84 \xa1Felicitaciones! Ya todos los participantes han descubierto sus amigos secretos. El intercambio puede comenzar. \uD83C\uDF81","success"):"Participante ya revelado"===e.error?N("Ya has descubierto tu amigo secreto anteriormente.","info"):N("Error al generar la asignaci\xf3n. Int\xe9ntalo de nuevo.","error")}}}catch(e){console.error("Error generating assignment:",e),alert("Error al generar la asignaci\xf3n. Int\xe9ntalo de nuevo.")}}};return r?(0,a.jsx)("div",{className:"container py-5",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,a.jsx)("span",{className:"visually-hidden",children:"Cargando..."})}),(0,a.jsx)("p",{className:"mt-3",children:"Cargando evento..."})]})}):s?(0,a.jsxs)("div",{className:"container py-5",children:[(0,a.jsxs)("div",{className:"text-center mb-5",children:[(0,a.jsxs)("h1",{className:"display-title mb-3",children:["\uD83C\uDF81 ",s.name]}),(0,a.jsx)("p",{className:"text-muted mb-4",children:s.description}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("small",{className:"text-muted",children:["\uD83D\uDC65 ",s.participants.length," participantes"]})})]}),(0,a.jsxs)("div",{className:"main-card mx-auto p-4",children:[(0,a.jsxs)("div",{className:"text-center mb-4",children:[(0,a.jsx)("h3",{className:"mb-3",children:"Selecciona tu nombre"}),(0,a.jsx)("p",{className:"text-muted",children:"Haz clic en tu nombre para descubrir a qui\xe9n debes regalar"})]}),(0,a.jsx)("div",{className:"row justify-content-center",children:(0,a.jsx)("div",{className:"col-md-8",children:(0,a.jsx)("div",{className:"list-group",id:"participantsList",children:s.participants.map(e=>{let s=b.has(e.name);return(0,a.jsxs)("button",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center ".concat(s?"disabled":""),onClick:()=>w(e.name),disabled:s,children:[(0,a.jsx)("span",{children:e.name}),s&&(0,a.jsx)("span",{className:"badge bg-success",children:"Revelado"})]},e._id)})})})}),(0,a.jsxs)("div",{className:"text-center mt-4",children:[(0,a.jsx)("div",{className:"mb-2",children:(0,a.jsxs)("small",{className:"text-muted",children:[b.size," de ",s.participants.length," participantes han descubierto su amigo secreto"]})}),b.size===s.participants.length?(0,a.jsx)("div",{className:"alert alert-success py-2",children:(0,a.jsx)("small",{children:"\uD83C\uDF84 \xa1Felicitaciones! Todos los participantes han descubierto sus amigos secretos. \xa1El intercambio puede comenzar! \uD83C\uDF81"})}):(0,a.jsx)("div",{className:"progress",style:{height:"6px"},children:(0,a.jsx)("div",{className:"progress-bar bg-success",style:{width:"".concat(b.size/s.participants.length*100,"%")}})})]})]}),d&&(0,a.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.8)",zIndex:1060},children:(0,a.jsx)("div",{className:"modal-dialog modal-dialog-centered",children:(0,a.jsx)("div",{className:"modal-content party-modal",children:(0,a.jsxs)("div",{className:"modal-body text-center p-5",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("span",{style:{fontSize:"3rem"},children:"\uD83C\uDF89"})}),(0,a.jsx)("h4",{className:"mb-3",children:"\xa1Felicitaciones!"}),(0,a.jsxs)("div",{id:"secretAssignedText",children:[l,", ",(0,a.jsx)("br",{}),"tu Amigo Secreto es:",(0,a.jsx)("br",{}),(0,a.jsx)("strong",{style:{fontSize:"1.6rem",color:"#ff6b6b"},children:m})]}),(0,a.jsx)("button",{className:"btn btn-gradient mt-4 px-4 py-2",onClick:()=>{u(!1),o(null),h("")},style:{zIndex:1061},children:"\xa1Entendido!"})]})})})}),v&&v.show&&(0,a.jsxs)("div",{className:"toast show position-fixed",style:{top:"20px",right:"20px",zIndex:1070,minWidth:"300px"},role:"alert","aria-live":"assertive","aria-atomic":"true",children:[(0,a.jsxs)("div",{className:"toast-header bg-".concat("success"===v.type?"success":"error"===v.type?"danger":"info"," text-white"),children:[(0,a.jsxs)("strong",{className:"me-auto",children:["success"===v.type&&"\uD83C\uDF84 \xa1Felicitaciones!","error"===v.type&&"❌ Error","info"===v.type&&"ℹ️ Informaci\xf3n"]}),(0,a.jsx)("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>{g(null)},"aria-label":"Close"})]}),(0,a.jsx)("div",{className:"toast-body",children:v.message})]})]}):(0,a.jsx)("div",{className:"container py-5",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("span",{style:{fontSize:"4rem"},children:"\uD83C\uDF84"})}),(0,a.jsx)("h2",{children:"Evento no encontrado"}),(0,a.jsx)("p",{className:"text-muted",children:"El evento que buscas no existe o ha sido eliminado"})]})})}},9376:function(e,s,t){"use strict";var a=t(5475);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})}},function(e){e.O(0,[971,117,560],function(){return e(e.s=6981)}),_N_E=e.O()}]);