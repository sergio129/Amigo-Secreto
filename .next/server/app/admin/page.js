(()=>{var e={};e.id=3,e.ids=[3],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},20864:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>m,pages:()=>o,routeModule:()=>u,tree:()=>d}),a(66136),a(68739),a(35866);var t=a(23191),r=a(88716),n=a(37922),i=a.n(n),l=a(95231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);a.d(s,c);let d=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,66136)),"E:\\Proyectos\\Amigo Secreto\\app\\admin\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,68739)),"E:\\Proyectos\\Amigo Secreto\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],o=["E:\\Proyectos\\Amigo Secreto\\app\\admin\\page.tsx"],m="/admin/page",h={require:a,loadChunk:()=>Promise.resolve()},u=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},73952:(e,s,a)=>{Promise.resolve().then(a.bind(a,88381))},46768:(e,s,a)=>{Promise.resolve().then(a.bind(a,41713))},72763:(e,s,a)=>{Promise.resolve().then(a.t.bind(a,12994,23)),Promise.resolve().then(a.t.bind(a,96114,23)),Promise.resolve().then(a.t.bind(a,9727,23)),Promise.resolve().then(a.t.bind(a,79671,23)),Promise.resolve().then(a.t.bind(a,41868,23)),Promise.resolve().then(a.t.bind(a,84759,23))},88381:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>l});var t=a(10326),r=a(17577),n=a(77109),i=a(35047);function l(){let{data:e,status:s}=(0,n.useSession)(),a=(0,i.useRouter)(),[l,o]=(0,r.useState)([]),[m,h]=(0,r.useState)([]),[u,x]=(0,r.useState)(!0),[v,j]=(0,r.useState)(!1),[p,b]=(0,r.useState)(!1),[N,g]=(0,r.useState)(null),[y,f]=(0,r.useState)("events"),C=async()=>{try{let e=await fetch("/api/admin/events");if(e.ok){let s=await e.json();console.log("Loaded events:",s),o(s)}else console.error("Failed to load events:",e.status)}catch(e){console.error("Error loading events:",e)}finally{x(!1)}},E=async()=>{try{let e=await fetch("/api/admin/users");if(e.ok){let s=await e.json(),a=await Promise.all(s.map(async e=>{try{let s=await fetch(`/api/admin/users/${e._id}/events`);if(s.ok){let a=await s.json();return{...e,eventsCreated:a.length}}return{...e,eventsCreated:0}}catch(s){return console.error(`Error loading events for user ${e.email}:`,s),{...e,eventsCreated:0}}}));h(a)}else console.error("Failed to load users:",e.status)}catch(e){console.error("Error loading users:",e)}},w=async(e,s)=>{try{let a=await fetch("/api/admin/users",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,maxEvents:s})});if(a.ok)E();else{let e=await a.json();alert(`Error al actualizar el l\xedmite de eventos: ${e.error}`)}}catch(e){console.error("Error updating user limit:",e),alert("Error al actualizar el l\xedmite de eventos")}},D=async(e,s)=>{try{let a=await fetch("/api/admin/users",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,role:s})});if(a.ok)E();else{let e=await a.json();alert(`Error al actualizar el rol: ${e.error}`)}}catch(e){console.error("Error updating user role:",e),alert("Error al actualizar el rol")}},P=e=>{g(e),b(!0)},k=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar este evento? Se eliminar\xe1n tambi\xe9n todos los participantes asociados."))try{(await fetch(`/api/admin/events/${e}`,{method:"DELETE"})).ok?C():alert("Error al eliminar el evento")}catch(e){console.error("Error deleting event:",e),alert("Error al eliminar el evento")}};return"loading"===s||u?t.jsx("div",{className:"container py-5 text-center",children:t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:"Cargando..."})})}):e?(0,t.jsxs)("div",{className:"container py-4",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h1",{children:"\uD83C\uDF81 Panel de Administraci\xf3n"}),(0,t.jsxs)("p",{className:"text-muted",children:["Bienvenido, ",e.user?.email]})]}),t.jsx("div",{children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>{(0,n.signOut)({callbackUrl:"/admin/login"})},children:"Cerrar sesi\xf3n"})})]}),"admin"===e.user.role&&t.jsx("div",{className:"mb-4",children:(0,t.jsxs)("ul",{className:"nav nav-tabs",children:[t.jsx("li",{className:"nav-item",children:t.jsx("button",{className:`nav-link ${"events"===y?"active":""}`,onClick:()=>f("events"),children:"\uD83D\uDCC5 Gesti\xf3n de Eventos"})}),t.jsx("li",{className:"nav-item",children:t.jsx("button",{className:`nav-link ${"users"===y?"active":""}`,onClick:()=>f("users"),children:"\uD83D\uDC65 Gesti\xf3n de Usuarios"})})]})}),"events"===y||"admin"!==e.user.role?(0,t.jsxs)("div",{className:"row mb-4",children:[t.jsx("div",{className:"col-md-4",children:t.jsx("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[t.jsx("div",{className:"stats-icon",children:"\uD83C\uDF84"}),t.jsx("h3",{children:l.length}),t.jsx("p",{className:"text-muted",children:"Eventos Totales"})]})})}),t.jsx("div",{className:"col-md-4",children:t.jsx("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[t.jsx("div",{className:"stats-icon",children:"✅"}),t.jsx("h3",{children:l.filter(e=>e.isActive).length}),t.jsx("p",{className:"text-muted",children:"Eventos Activos"})]})})}),t.jsx("div",{className:"col-md-4",children:t.jsx("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[t.jsx("div",{className:"stats-icon",children:"\uD83D\uDC65"}),t.jsx("h3",{children:l.reduce((e,s)=>e+(s.participantCount||0),0)}),t.jsx("p",{className:"text-muted",children:"Participantes Totales"})]})})})]}):(0,t.jsxs)("div",{className:"row mb-4",children:[t.jsx("div",{className:"col-md-3",children:t.jsx("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[t.jsx("div",{className:"stats-icon",children:"\uD83D\uDC65"}),t.jsx("h3",{children:m.length}),t.jsx("p",{className:"text-muted",children:"Usuarios Registrados"})]})})}),t.jsx("div",{className:"col-md-3",children:t.jsx("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[t.jsx("div",{className:"stats-icon",children:"\uD83D\uDC51"}),t.jsx("h3",{children:m.filter(e=>"admin"===e.role).length}),t.jsx("p",{className:"text-muted",children:"Administradores"})]})})}),t.jsx("div",{className:"col-md-3",children:t.jsx("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[t.jsx("div",{className:"stats-icon",children:"\uD83C\uDF81"}),t.jsx("h3",{children:m.filter(e=>"guest"===e.role).reduce((e,s)=>e+s.maxEvents,0)}),t.jsx("p",{className:"text-muted",children:"L\xedmite Total de Eventos"})]})})}),t.jsx("div",{className:"col-md-3",children:t.jsx("div",{className:"card stats-card",children:(0,t.jsxs)("div",{className:"card-body text-center",children:[t.jsx("div",{className:"stats-icon",children:"\uD83D\uDCC5"}),t.jsx("h3",{children:m.reduce((e,s)=>e+(s.eventsCreated||0),0)}),t.jsx("p",{className:"text-muted",children:"Eventos Creados"})]})})})]}),"events"===y||"admin"!==e.user.role?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[t.jsx("h2",{children:"Eventos"}),t.jsx("button",{className:"btn btn-gradient",onClick:()=>j(!0),children:"➕ Crear Evento"})]}),0===l.length?t.jsx("div",{className:"card",children:(0,t.jsxs)("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"mb-3",children:"\uD83C\uDF81"}),t.jsx("h4",{children:"No hay eventos creados"}),t.jsx("p",{className:"text-muted",children:"Crea tu primer evento de Amigo Secreto"}),t.jsx("button",{className:"btn btn-gradient",onClick:()=>j(!0),children:"Crear Primer Evento"})]})}):t.jsx("div",{className:"row",children:l.map(e=>t.jsx("div",{className:"col-md-6 col-lg-4 mb-3",children:(0,t.jsxs)("div",{className:"card event-card h-100",children:[(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[t.jsx("h5",{className:"card-title",children:e.name}),t.jsx("span",{className:`badge ${e.isActive?"bg-success":"bg-secondary"}`,children:e.isActive?"Activo":"Inactivo"})]}),t.jsx("p",{className:"card-text text-muted",children:e.description}),t.jsx("p",{className:"card-text",children:(0,t.jsxs)("small",{className:"text-muted",children:["\uD83D\uDCC5 ",new Date(e.date).toLocaleDateString("es-ES")]})}),t.jsx("p",{className:"card-text",children:(0,t.jsxs)("small",{className:"text-muted",children:["\uD83D\uDC65 ",e.participantCount||0," participantes"]})})]}),(0,t.jsxs)("div",{className:"card-footer bg-transparent",children:[t.jsx("button",{className:"btn btn-outline-warning btn-sm me-2",onClick:()=>P(e),children:"✏️ Editar"}),t.jsx("button",{className:"btn btn-outline-primary btn-sm me-2",onClick:()=>a.push(`/admin/events/${e._id}`),children:"Gestionar"}),t.jsx("button",{className:"btn btn-outline-success btn-sm me-2",onClick:()=>window.open(`/event/${e._id}`,"_blank"),children:"Ver P\xfablico"}),t.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>k(e._id),children:"Eliminar"})]})]})},e._id))})]}):(0,t.jsxs)(t.Fragment,{children:[t.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:t.jsx("h2",{children:"Gesti\xf3n de Usuarios"})}),0===m.length?t.jsx("div",{className:"card",children:(0,t.jsxs)("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"mb-3",children:"\uD83D\uDC65"}),t.jsx("h4",{children:"No hay usuarios registrados"}),t.jsx("p",{className:"text-muted",children:"Los usuarios invitados aparecer\xe1n aqu\xed cuando se registren"})]})}):t.jsx("div",{className:"card",children:t.jsx("div",{className:"card-body",children:t.jsx("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-hover",children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{children:[t.jsx("th",{children:"Nombre"}),t.jsx("th",{children:"Email"}),t.jsx("th",{children:"Rol"}),t.jsx("th",{children:"L\xedmite de Eventos"}),t.jsx("th",{children:"Eventos Creados"}),t.jsx("th",{children:"Fecha de Registro"}),t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:m.map(s=>(0,t.jsxs)("tr",{children:[t.jsx("td",{children:s.name}),t.jsx("td",{children:s.email}),t.jsx("td",{children:(0,t.jsxs)("select",{className:"form-select form-select-sm",value:s.role,onChange:e=>D(s._id,e.target.value),disabled:s.email===e.user?.email,children:[t.jsx("option",{value:"guest",children:"Invitado"}),t.jsx("option",{value:"admin",children:"Administrador"})]})}),t.jsx("td",{children:t.jsx("input",{type:"number",className:"form-control form-control-sm",style:{width:"80px"},min:"1",value:s.maxEvents,onChange:e=>{let a=parseInt(e.target.value);a>=1&&w(s._id,a)},disabled:"admin"===s.role})}),t.jsx("td",{children:t.jsx("span",{className:"badge bg-secondary",children:s.eventsCreated||0})}),t.jsx("td",{children:new Date(s.createdAt).toLocaleDateString("es-ES")}),t.jsx("td",{children:t.jsx("small",{className:"text-muted",children:s.email===e.user?.email?"Tu cuenta":"admin"===s.role?"Admin":"Editable"})})]},s._id))})]})})})})]}),v&&t.jsx(c,{onClose:()=>j(!1),onSuccess:()=>{j(!1),C()}}),p&&N&&t.jsx(d,{event:N,onClose:()=>{b(!1),g(null)},onSuccess:()=>{b(!1),g(null),C()}})]}):null}function c({onClose:e,onSuccess:s}){let[a,n]=(0,r.useState)({name:"",description:"",date:""}),[i,l]=(0,r.useState)(!1),[c,d]=(0,r.useState)(""),o=async e=>{e.preventDefault(),l(!0),d("");try{let e=await fetch("/api/admin/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(e.ok)s();else{let s=await e.json();d(s.error||"Error al crear el evento")}}catch(e){d("Error de conexi\xf3n")}finally{l(!1)}};return t.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:t.jsx("div",{className:"modal-dialog",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[t.jsx("h5",{className:"modal-title",children:"Crear Nuevo Evento"}),t.jsx("button",{type:"button",className:"btn-close",onClick:e})]}),(0,t.jsxs)("form",{onSubmit:o,children:[(0,t.jsxs)("div",{className:"modal-body",children:[c&&t.jsx("div",{className:"alert alert-danger",children:c}),(0,t.jsxs)("div",{className:"mb-3",children:[t.jsx("label",{htmlFor:"name",className:"form-label",children:"Nombre del Evento"}),t.jsx("input",{type:"text",className:"form-control",id:"name",value:a.name,onChange:e=>n({...a,name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[t.jsx("label",{htmlFor:"description",className:"form-label",children:"Descripci\xf3n"}),t.jsx("textarea",{className:"form-control",id:"description",rows:3,value:a.description,onChange:e=>n({...a,description:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[t.jsx("label",{htmlFor:"date",className:"form-label",children:"Fecha del Evento"}),t.jsx("input",{type:"date",className:"form-control",id:"date",value:a.date,onChange:e=>n({...a,date:e.target.value}),required:!0})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,children:"Cancelar"}),t.jsx("button",{type:"submit",className:"btn btn-gradient",disabled:i,children:i?"Creando...":"Crear Evento"})]})]})]})})})}function d({event:e,onClose:s,onSuccess:a}){let[n,i]=(0,r.useState)({name:e.name,description:e.description,date:e.date.split("T")[0],isActive:e.isActive}),[l,c]=(0,r.useState)(!1),[d,o]=(0,r.useState)(""),m=async s=>{s.preventDefault(),c(!0),o("");try{let s=await fetch(`/api/admin/events/${e._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(s.ok)a();else{let e=await s.json();o(e.error||"Error al actualizar el evento")}}catch(e){console.error("Error updating event:",e),o("Error al actualizar el evento")}finally{c(!1)}};return t.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:t.jsx("div",{className:"modal-dialog modal-lg",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[t.jsx("h5",{className:"modal-title",children:"✏️ Editar Evento"}),t.jsx("button",{type:"button",className:"btn-close",onClick:s})]}),(0,t.jsxs)("form",{onSubmit:m,children:[(0,t.jsxs)("div",{className:"modal-body",children:[d&&t.jsx("div",{className:"alert alert-danger",children:d}),(0,t.jsxs)("div",{className:"mb-3",children:[t.jsx("label",{htmlFor:"edit-name",className:"form-label",children:"Nombre del Evento"}),t.jsx("input",{type:"text",className:"form-control",id:"edit-name",value:n.name,onChange:e=>i({...n,name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[t.jsx("label",{htmlFor:"edit-description",className:"form-label",children:"Descripci\xf3n"}),t.jsx("textarea",{className:"form-control",id:"edit-description",rows:3,value:n.description,onChange:e=>i({...n,description:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[t.jsx("label",{htmlFor:"edit-date",className:"form-label",children:"Fecha del Evento"}),t.jsx("input",{type:"date",className:"form-control",id:"edit-date",value:n.date,onChange:e=>i({...n,date:e.target.value}),required:!0})]}),t.jsx("div",{className:"mb-3",children:(0,t.jsxs)("div",{className:"form-check",children:[t.jsx("input",{className:"form-check-input",type:"checkbox",id:"edit-isActive",checked:n.isActive,onChange:e=>i({...n,isActive:e.target.checked})}),t.jsx("label",{className:"form-check-label",htmlFor:"edit-isActive",children:"Evento activo (visible para participantes)"})]})})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:s,children:"Cancelar"}),t.jsx("button",{type:"submit",className:"btn btn-gradient",disabled:l,children:l?"Actualizando...":"Actualizar Evento"})]})]})]})})})}},41713:(e,s,a)=>{"use strict";a.d(s,{default:()=>n});var t=a(10326),r=a(77109);function n({children:e}){return t.jsx(r.SessionProvider,{children:e})}},35047:(e,s,a)=>{"use strict";var t=a(77389);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}})},66136:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>t});let t=(0,a(68570).createProxy)(String.raw`E:\Proyectos\Amigo Secreto\app\admin\page.tsx#default`)},68739:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>c,metadata:()=>l});var t=a(19510),r=a(77366),n=a.n(r);a(67272);let i=(0,a(68570).createProxy)(String.raw`E:\Proyectos\Amigo Secreto\components\SessionProvider.tsx#default`),l={title:"Amigo Secreto",description:"Selecciona tu nombre y descubre a qui\xe9n debes regalar"};function c({children:e}){return(0,t.jsxs)("html",{lang:"es",children:[(0,t.jsxs)("head",{children:[t.jsx("link",{href:"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css",rel:"stylesheet"}),t.jsx("link",{href:"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap",rel:"stylesheet"}),t.jsx("link",{rel:"icon",href:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'%3E%3Ctext y='32' font-size='32'%3E%F0%9F%8E%81%3C/text%3E%3C/svg%3E"})]}),(0,t.jsxs)("body",{className:n().className,children:[t.jsx(i,{children:e}),t.jsx("script",{src:"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"})]})]})}},67272:()=>{}};var s=require("../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[276,571],()=>a(20864));module.exports=t})();